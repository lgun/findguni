<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì•„ì´í…œ í¸ì§‘</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        * {
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Noto Sans KR', sans-serif;
            margin: 0;
            padding: 20px;
            background: #f8f9fa;
            color: #2c3e50;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            margin: 0;
            font-size: 28px;
            font-weight: 600;
        }
        
        .nav-buttons {
            padding: 20px 30px;
            border-bottom: 1px solid #eee;
        }
        
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            text-decoration: none;
            display: inline-block;
            transition: all 0.2s;
        }
        
        .btn-secondary {
            background: #95a5a6;
            color: white;
        }
        
        .btn-secondary:hover {
            background: #7f8c8d;
        }
        
        .btn-primary {
            background: #3498db;
            color: white;
        }
        
        .btn-primary:hover {
            background: #2980b9;
        }
        
        .content {
            padding: 30px;
        }
        
        .form-group {
            margin-bottom: 25px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #2c3e50;
        }
        
        .form-group input,
        .form-group textarea {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 14px;
            font-family: inherit;
            transition: border-color 0.2s;
        }
        
        .form-group input:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #3498db;
        }
        
        .form-group textarea {
            resize: vertical;
            min-height: 100px;
        }
        
        .form-help {
            font-size: 12px;
            color: #7f8c8d;
            margin-top: 5px;
        }
        
        .form-actions {
            display: flex;
            gap: 15px;
            justify-content: flex-end;
            padding-top: 20px;
            border-top: 1px solid #eee;
        }
        
        .image-preview {
            margin-top: 10px;
            text-align: center;
        }
        
        .image-preview img {
            max-width: 200px;
            max-height: 200px;
            border-radius: 8px;
            border: 2px solid #e9ecef;
        }
        
        .image-placeholder {
            width: 200px;
            height: 200px;
            background: #f8f9fa;
            border: 2px dashed #bdc3c7;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 10px auto;
            color: #7f8c8d;
            font-size: 48px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1 th:text="${item.id != null ? 'ì•„ì´í…œ ìˆ˜ì •' : 'ìƒˆ ì•„ì´í…œ ì¶”ê°€'}">ì•„ì´í…œ í¸ì§‘</h1>
        </div>
        
        <div class="nav-buttons">
            <a href="/admin/items" class="btn btn-secondary">â† ì•„ì´í…œ ëª©ë¡</a>
        </div>
        
        <div class="content">
            <form th:action="@{/admin/items/save}" method="post" th:object="${item}">
                <div class="form-group">
                    <label for="id">ì•„ì´í…œ ID</label>
                    <input type="text" id="id" th:field="*{id}" 
                           th:readonly="${item.id != null}"
                           placeholder="ì˜ˆ: key-001, potion-heal"
                           required>
                    <div class="form-help">ê³ ìœ í•œ ì•„ì´í…œ IDë¥¼ ì…ë ¥í•˜ì„¸ìš”. ìˆ˜ì • ì‹œì—ëŠ” ë³€ê²½í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</div>
                </div>
                
                <div class="form-group">
                    <label for="name">ì•„ì´í…œ ì´ë¦„</label>
                    <input type="text" id="name" th:field="*{name}" 
                           placeholder="ì˜ˆ: ì—´ì‡ , ì¹˜ë£Œ í¬ì…˜"
                           required>
                    <div class="form-help">ê²Œì„ì—ì„œ í‘œì‹œë  ì•„ì´í…œì˜ ì´ë¦„ì…ë‹ˆë‹¤.</div>
                </div>
                
                <div class="form-group">
                    <label for="description">ì•„ì´í…œ ì„¤ëª…</label>
                    <textarea id="description" th:field="*{description}" 
                              placeholder="ì´ ì•„ì´í…œì˜ ìš©ë„ë‚˜ íŠ¹ì§•ì„ ì„¤ëª…í•´ì£¼ì„¸ìš”."></textarea>
                    <div class="form-help">ì•„ì´í…œì„ í´ë¦­í–ˆì„ ë•Œ í‘œì‹œë˜ëŠ” ì„¤ëª…ì…ë‹ˆë‹¤.</div>
                </div>
                
                <div class="form-group">
                    <label for="selectedItemImage">ì•„ì´í…œ ì´ë¯¸ì§€ ì„ íƒ</label>
                    <select id="selectedItemImage" name="selectedItemImage" 
                            th:onchange="previewItemImage(this.value)"
                            style="width: 100%; padding: 12px 15px; border: 2px solid #e9ecef; border-radius: 8px; font-size: 14px;">
                        <option value="">ì´ë¯¸ì§€ë¥¼ ì„ íƒí•˜ì„¸ìš”</option>
                        <option th:each="image : ${availableItemImages}" 
                                th:value="${image}" 
                                th:text="${image}"
                                th:selected="${item.imageUrl != null && item.imageUrl.contains(image)}">
                        </option>
                    </select>
                    <div class="form-help">resources/static/images/items í´ë”ì˜ ì´ë¯¸ì§€ë¥¼ ì„ íƒí•˜ì„¸ìš”.</div>
                    
                    <div class="image-preview">
                        <img id="preview" th:src="${item.imageUrl}" th:alt="${item.name}" 
                             style="display: none;"
                             th:style="${item.imageUrl != null ? 'display: block;' : 'display: none;'}">
                        <div id="placeholder" class="image-placeholder" 
                             th:style="${item.imageUrl != null ? 'display: none;' : 'display: flex;'}">
                            ğŸ“¦
                        </div>
                    </div>
                    
                    <!-- ê¸°ì¡´ URL ì…ë ¥ ë°©ì‹ë„ ìœ ì§€ (ê³ ê¸‰ ì‚¬ìš©ììš©) -->
                    <div style="margin-top: 15px;">
                        <label for="imageUrl">ë˜ëŠ” ì§ì ‘ ì´ë¯¸ì§€ URL ì…ë ¥</label>
                        <input type="text" id="imageUrl" th:field="*{imageUrl}" 
                               placeholder="https://example.com/image.jpg ë˜ëŠ” /images/items/file.png"
                               onchange="previewImage(this.value)"
                               style="width: 100%; padding: 12px 15px; border: 2px solid #e9ecef; border-radius: 8px; font-size: 14px;">
                        <div class="form-help">ì™¸ë¶€ ì´ë¯¸ì§€ URL ë˜ëŠ” ë¡œì»¬ ì´ë¯¸ì§€ ê²½ë¡œë¥¼ ì§ì ‘ ì…ë ¥í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.</div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="pageId">ì—°ê²°ëœ í˜ì´ì§€ ID</label>
                    <input type="text" id="pageId" th:field="*{pageId}" 
                           placeholder="ì˜ˆ: room-001, puzzle-final">
                    <div class="form-help">ì´ ì•„ì´í…œì„ íšë“í•  ìˆ˜ ìˆëŠ” í˜ì´ì§€ IDì…ë‹ˆë‹¤. ë¹„ì›Œë‘ë©´ ìˆ˜ë™ìœ¼ë¡œ ì§€ê¸‰í•´ì•¼ í•©ë‹ˆë‹¤.</div>
                </div>
                
                <div class="form-actions">
                    <a href="/admin/items" class="btn btn-secondary">ì·¨ì†Œ</a>
                    <button type="submit" class="btn btn-primary">ì €ì¥</button>
                </div>
            </form>
        </div>
    </div>
    
    <script>
        function previewItemImage(fileName) {
            const preview = document.getElementById('preview');
            const placeholder = document.getElementById('placeholder');
            const imageUrlInput = document.getElementById('imageUrl');
            
            if (fileName && fileName.trim() !== '') {
                const imageUrl = '/images/items/' + fileName;
                preview.src = imageUrl;
                preview.style.display = 'block';
                placeholder.style.display = 'none';
                
                // ì§ì ‘ ì…ë ¥ í•„ë“œë„ ì—…ë°ì´íŠ¸
                imageUrlInput.value = imageUrl;
                
                preview.onerror = function() {
                    preview.style.display = 'none';
                    placeholder.style.display = 'flex';
                    alert('ì´ë¯¸ì§€ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. íŒŒì¼ì´ ì¡´ì¬í•˜ëŠ”ì§€ í™•ì¸í•´ì£¼ì„¸ìš”.');
                };
            } else {
                preview.style.display = 'none';
                placeholder.style.display = 'flex';
                imageUrlInput.value = '';
            }
        }
        
        function previewImage(url) {
            const preview = document.getElementById('preview');
            const placeholder = document.getElementById('placeholder');
            const selectElement = document.getElementById('selectedItemImage');
            
            if (url && url.trim() !== '') {
                preview.src = url;
                preview.style.display = 'block';
                placeholder.style.display = 'none';
                
                // URLì—ì„œ íŒŒì¼ëª… ì¶”ì¶œí•˜ì—¬ ì…€ë ‰íŠ¸ ë°•ìŠ¤ ë™ê¸°í™”
                if (url.includes('/images/items/')) {
                    const fileName = url.split('/images/items/')[1];
                    selectElement.value = fileName;
                }
                
                preview.onerror = function() {
                    preview.style.display = 'none';
                    placeholder.style.display = 'flex';
                };
            } else {
                preview.style.display = 'none';
                placeholder.style.display = 'flex';
                selectElement.value = '';
            }
        }
        
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ë¯¸ì§€ ë¯¸ë¦¬ë³´ê¸°
        document.addEventListener('DOMContentLoaded', function() {
            const imageUrl = document.getElementById('imageUrl').value;
            if (imageUrl) {
                previewImage(imageUrl);
            }
        });
    </script>
</body>
</html>